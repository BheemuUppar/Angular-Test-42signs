import{B as W,D,Fb as o,Gb as b,Ha as j,Hb as m,Ib as H,Ja as c,Kb as N,Mb as v,Nb as O,Oa as f,Ob as V,Q as u,T as I,Ua as F,Y as k,Za as x,eb as h,fa as E,ga as T,hb as $,ic as q,j as w,kb as B,kc as K,lb as M,lc as z,mb as a,mc as J,nb as n,o as C,ob as A,qd as R,s as S,sb as P,tc as L,ub as g,vb as y,wc as d,y as _}from"./chunk-AUB4PFHX.js";var l=class r{constructor(t){this.http=t}weather=d.weather;forecast=d.forecast;getWeatherByCity(t){return this.http.get(`${this.weather}?q=${t}&units=metric&appid=${d.openWeatherApiKey}`).pipe(S(e=>({temp:e.main.temp,feels_like:e.main.feels_like,temp_min:e.main.temp_min,temp_max:e.main.temp_max,description:e.weather[0].description,icon:`https://openweathermap.org/img/wn/${e.weather[0].icon}@2x.png`,city:e.name,country:e.sys.country})))}getForecast(t){return this.http.get(`${this.forecast}?q=${t}&units=metric&appid=${d.openWeatherApiKey}`)}static \u0275fac=function(e){return new(e||r)(k(L))};static \u0275prov=I({token:r,factory:r.\u0275fac,providedIn:"root"})};var Z=(r,t)=>t.date;function ee(r,t){r&1&&(a(0,"div",5),o(1," Loading weather data... "),n())}function te(r,t){if(r&1){let e=P();a(0,"div",6)(1,"span",7),o(2,"Failed to fetch current weather"),n(),a(3,"button",8),g("click",function(){E(e);let s=y();return T(s.retryWeather())}),o(4," \u{1F504} "),n()()}}function ie(r,t){if(r&1&&(a(0,"div",19)(1,"p",20),o(2),v(3,"date"),n(),a(4,"p",21),o(5),n()()),r&2){let e=t.$implicit;c(2),b(V(3,2,e.date,"MMM d")),c(3),m("",e.avgTemp,"\xB0C")}}function re(r,t){if(r&1&&(a(0,"h2",9),o(1),n(),a(2,"div",10)(3,"div")(4,"h3",11),o(5,"Current Weather"),n(),a(6,"p",12),o(7),v(8,"titlecase"),n(),a(9,"p",13),o(10),n(),a(11,"p",14),o(12),n(),a(13,"p",15),o(14),n()(),a(15,"div"),A(16,"img",16),n()(),a(17,"h3",17),o(18,"Average temp for next 4 days"),n(),a(19,"div",18),B(20,ie,6,5,"div",19,Z),n()),r&2){let e=y();c(),m(" \u{1F306} ",e.currentCity," "),c(6),b(O(8,7,e.currentWeather.description)),c(3),m("",e.currentWeather.temp,"\xB0C"),c(2),m("Feels like: ",e.currentWeather.feels_like,"\xB0C"),c(2),H("\u{1F30D} ",e.currentWeather.city,", ",e.currentWeather.country,""),c(2),h("src",e.currentWeather.icon,j),c(4),M(e.forecastWeather)}}var U=class r{constructor(t,e){this.weatherService=t;this.snackbarService=e;this.fetchAllData(this.currentCity),this.searchSubject.pipe(D(500)).subscribe(i=>{i&&(this.currentCity=i,this.fetchAllData(i))})}currentCity="Bengaluru";currentWeather;forecastWeather=[];dailyData={};loading=!1;error=!1;searchSubject=new w;onSearchChange(t){let e=t.target.value.trim();e?this.searchSubject.next(e):this.searchSubject.next("Bengaluru")}fetchAllData(t){this.loading=!0,this.error=!1;let e=this.weatherService.getWeatherByCity(t),i=this.weatherService.getForecast(t);_([e,i]).pipe(u(([s,p])=>{this.currentCity=t,this.currentWeather=s,this.groupIntoDaywise(p),this.forecastWeather=this.getForecast()}),W(s=>(console.error(s),this.error=!0,this.currentWeather=void 0,this.forecastWeather=[],C(null))),u(()=>{this.loading=!1})).subscribe({next:()=>{},error:s=>{this.error=!0,this.loading=!1,this.snackbarService.error(s.error.message)}})}groupIntoDaywise(t){this.dailyData={},t.list.forEach(e=>{let i=e.dt_txt.split(" ")[0];this.dailyData[i]||(this.dailyData[i]=[]),this.dailyData[i].push(e.main.temp)})}getForecast(){return Object.keys(this.dailyData).slice(1,5).map(i=>{let s=this.dailyData[i],p=s.reduce((G,Q)=>G+Q,0)/s.length;return{date:i,avgTemp:Math.round(p)}})}retryWeather(){this.fetchAllData(this.currentCity)}static \u0275fac=function(e){return new(e||r)(f(l),f(R))};static \u0275cmp=F({type:r,selectors:[["app-weather"]],features:[N([l])],decls:6,vars:3,consts:[["class","loader bg-blue-500 text-white p-2 rounded text-center",4,"ngIf"],["class","flex items-center bg-yellow-400 text-black p-2 rounded",4,"ngIf"],[1,"p-6","max-w-2xl","mx-auto"],[1,"flex","items-center","gap-2","mb-6"],["type","text","placeholder","Search city...",1,"border","border-gray-300","rounded-md","px-4","py-2","w-full","focus:outline-none","focus:ring-2","focus:ring-blue-400",3,"input"],[1,"loader","bg-blue-500","text-white","p-2","rounded","text-center"],[1,"flex","items-center","bg-yellow-400","text-black","p-2","rounded"],[1,"mr-2"],["aria-label","Retry",1,"bg-yellow-600","p-2","rounded","hover:bg-yellow-700","transition",3,"click"],[1,"text-2xl","font-semibold","text-gray-800","mb-4","text-center"],[1,"bg-gradient-to-r","from-blue-500","to-indigo-500","text-white","rounded-2xl","p-6","flex","items-center","justify-between","shadow-lg","mb-8"],[1,"text-xl","font-semibold","mb-1"],[1,"text-sm","opacity-80"],[1,"text-4xl","font-bold","mt-2"],[1,"text-sm","mt-1"],[1,"text-xs","mt-2"],["alt","weather icon",1,"w-20","h-20",3,"src"],[1,"text-xl","font-semibold","mb-4","text-gray-700"],[1,"grid","grid-cols-2","sm:grid-cols-4","gap-4"],[1,"bg-white","rounded-xl","shadow","p-4","text-center","hover:scale-105","transition-transform","duration-200","border"],[1,"text-gray-600","font-medium"],[1,"text-2xl","font-bold","text-blue-600","mt-2"]],template:function(e,i){e&1&&(x(0,ee,2,0,"div",0)(1,te,5,0,"div",1),a(2,"div",2)(3,"div",3)(4,"input",4),g("input",function(p){return i.onSearchChange(p)}),n()(),x(5,re,22,9),n()),e&2&&(h("ngIf",i.loading),c(),h("ngIf",i.error),c(4),$(i.currentWeather?5:-1))},dependencies:[J,q,K,z],encapsulation:2})};export{U as WeatherComponent};
